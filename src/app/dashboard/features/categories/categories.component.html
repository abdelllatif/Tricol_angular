<div class="max-w-7xl mx-auto">
  <!-- Header -->
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-4xl font-bold text-gray-800">Gestion des Catégories</h1>
      <p class="text-gray-600">{{ totalElements }} catégorie{{ totalElements > 1 ? 's' : '' }}</p>
    </div>
    <button (click)="openModal(null, 'add')"
            class="bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-700 flex items-center">
      <i class="fas fa-plus mr-2"></i> Nouvelle
    </button>
  </div>

  <!-- Search Bar -->
  <div class="mb-6">
    <input type="text"
           [(ngModel)]="searchTerm"
           (input)="onSearch()"
           placeholder="Rechercher une catégorie..."
           class="w-full px-6 py-4 rounded-xl border">
  </div>

  <!-- Page Size Selector -->
  <div class="flex items-center gap-2 mb-4">
    <label for="pageSize" class="font-medium text-lg">Afficher :</label>
    <select id="pageSize"
            [(ngModel)]="pageSize"
            (change)="onPageSizeChange()"
            class="border rounded px-3 py-2">
      <option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
    </select>
    <span>catégories par page</span>
  </div>

  <!-- Error -->
  <div *ngIf="error"
       class="bg-red-100 border border-red-400 text-red-700 px-6 py-4 rounded-xl mb-6">
    <strong>Erreur :</strong> {{ error }}
    <br><small>Vérifie : Backend lancé ? CORS activé ? URL correcte ?</small>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-16">
    <div class="animate-spin inline-block w-12 h-12 border-4 border-blue-600 rounded-full"></div>
    <p class="mt-4">Chargement...</p>
  </div>

  <!-- Table -->
  <div *ngIf="!loading && !error" class="bg-white rounded-xl shadow overflow-hidden">
    <table class="w-full">
      <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-4 text-left cursor-pointer" (click)="sort('nom')">
          Nom {{ sortKey==='nom' ? (sortOrder==='asc'?'↑':'↓') : '' }}
        </th>
        <th class="px-6 py-4 text-center">Nombre de Produits</th>
        <th class="px-6 py-4 text-center">Actions</th>
      </tr>
      </thead>

      <tbody>
      <tr *ngFor="let c of categories" class="hover:bg-gray-50 border-b">
        <td class="px-6 py-4 font-medium">{{ c.nom }}</td>
        <td class="px-6 py-4 text-center">
          <span class="inline-flex items-center px-4 py-2 rounded-full text-sm font-bold"
                [class.bg-green-100]="c.nombreProduits > 10"
                [class.text-green-800]="c.nombreProduits > 10"
                [class.bg-yellow-100]="c.nombreProduits > 0 && c.nombreProduits <= 10"
                [class.text-yellow-800]="c.nombreProduits > 0 && c.nombreProduits <= 10"
                [class.bg-red-100]="c.nombreProduits === 0"
                [class.text-red-800]="c.nombreProduits === 0">
            {{ c.nombreProduits }}
            <span class="ml-1 text-xs">
              produit{{ c.nombreProduits > 1 ? 's' : '' }}
            </span>
          </span>
        </td>
        <td class="px-6 py-4 text-center">
          <div class="flex items-center justify-center gap-4">
            <button (click)="openModal(c, 'edit')" class="text-green-600 hover:text-green-800 transition">
              <i class="fas fa-edit"></i>
            </button>
            <button (click)="delete(c)" class="text-red-600 hover:text-red-800 transition">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </td>
      </tr>
      </tbody>
    </table>

    <!-- Pagination -->
    <div class="flex justify-between items-center mt-4 px-6 py-3">
      <div class="flex justify-center mt-6 w-full">
        <nav class="inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination" *ngIf="totalPages > 1">

          <!-- Previous -->
          <button (click)="goToPage(page - 1)"
                  [disabled]="page === 1"
                  class="px-3 py-2 rounded-l-md border border-gray-300 bg-white text-gray-500 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
            &laquo;
          </button>

          <!-- Page Numbers -->
          <button *ngFor="let p of pageNumbers"
                  (click)="goToPage(p)"
                  [ngClass]="{'bg-blue-600 text-white': p === page,'bg-white text-gray-700 hover:bg-gray-800': p !== page}" class="px-4 py-2 border border-gray-300">{{ p }}
          </button>


          <!-- Next -->
          <button (click)="goToPage(page + 1)"
                  [disabled]="page === totalPages"
                  class="px-3 py-2 rounded-r-md border border-gray-300 bg-white text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
            &raquo;
          </button>
        </nav>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div *ngIf="showModal" class="fixed inset-0 bg-black/60 flex items-center justify-center z-50"
       (click)="showModal = false">
    <div class="bg-white rounded-3xl p-8 max-w-md w-full shadow-2xl" (click)="$event.stopPropagation()">
      <h2 class="text-3xl font-black mb-8 text-gray-800">
        {{ mode === 'add' ? 'Nouvelle' : 'Modifier' }} Catégorie
      </h2>
      <form (ngSubmit)="save()" class="space-y-6">
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Nom de la catégorie *</label>
          <input [(ngModel)]="selected.nom" name="nom" required
                 placeholder="Ex: Santé, Informatique..."
                 class="w-full px-5 py-4 rounded-xl border-2 border-gray-300 focus:border-blue-600 focus:outline-none text-lg">
        </div>
        <div class="flex justify-end space-x-4 pt-6">
          <button type="button" (click)="showModal = false"
                  class="px-8 py-4 rounded-xl border-2 border-gray-300 hover:bg-gray-50 font-semibold">
            Annuler
          </button>
          <button type="submit"
                  class="px-8 py-4 rounded-xl bg-blue-600 text-white font-bold hover:bg-blue-700 shadow-lg">
            {{ mode === 'add' ? 'Créer' : 'Mettre à jour' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
