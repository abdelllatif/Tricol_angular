<div class="max-w-7xl mx-auto ">
  <div class="flex justify-between items-center mb-8">
    <div>
      <h1 class="text-4xl font-bold text-gray-800">Gestion des Fournisseurs</h1>
      <p class="text-gray-600">{{ totalElements }} fournisseur{{ totalElements > 1 ? 's' : '' }}</p>
    </div>
    <button (click)="openModal(null, 'add')" class="bg-blue-600 text-white px-6 py-3 rounded-xl font-semibold hover:bg-blue-700 flex items-center">
      <i class="fas fa-plus mr-2"></i> Nouveau
    </button>
  </div>

  <div class="mb-6">
    <input type="text" [(ngModel)]="searchTerm" (input)="onSearch()" placeholder="Rechercher..." class="w-full px-6 py-4 rounded-xl border">
  </div>
  <!-- Page Size Selector -->
  <div class="flex items-center gap-2">
    <label for="pageSize" class="font-medium text-lg">Afficher :</label>
    <select id="pageSize" [(ngModel)]="pageSize" (change)="onPageSizeChange()"
            class="border rounded px-3 py-2">
      <option *ngFor="let size of pageSizes" [value]="size">{{size}}</option>
    </select>
    <span>fournisseurs par page</span>
  </div>
  <!-- Erreur -->
  <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-6 py-4 rounded-xl mb-6">
    <strong>Erreur :</strong> {{ errorMessage }}
    <br><small>Vérifie : Backend lancé ? CORS activé ? URL correcte ?</small>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="text-center py-16">
    <div class="animate-spin inline-block w-12 h-12 border-4 border-blue-600 rounded-full"></div>
    <p class="mt-4">Chargement...</p>
  </div>

  <!-- Tableau -->
  <div *ngIf="!loading && !errorMessage" class="bg-white rounded-xl shadow overflow-hidden">
    <table class="w-full">
      <thead class="bg-gray-50">
      <tr>
        <th class="px-6 py-4 text-left cursor-pointer" (click)="sort('societe')">Société {{ sortKey==='societe' ? (sortOrder==='asc'?'↑':'↓') : '' }}</th>
        <th class="px-6 py-4 text-left">Contact</th>
        <th class="px-6 py-4 text-left cursor-pointer" (click)="sort('ville')">Ville {{ sortKey==='ville' ? (sortOrder==='asc'?'↑':'↓') : '' }}</th>
        <th class="px-6 py-4 text-left">ICE</th>
        <th class="px-6 py-4 text-left">Téléphone</th>
        <th class="px-6 py-4 text-left">Email</th>
        <th class="px-6 py-4 text-center">Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let f of fournisseurs" class="hover:bg-gray-50 border-b">
        <td class="px-6 py-4 font-medium">{{ truncate(f.societe) }}</td>
        <td class="px-6 py-4">{{ truncate(f.contact) }}</td>
        <td class="px-6 py-4">{{ truncate(f.ville) }}</td>
        <td class="px-6 py-4 font-mono">{{ truncate(f.ice) }}</td>
        <td class="px-6 py-4">{{ truncate(f.telephone) }}</td>
        <td class="px-6 py-4">{{ truncate(f.email) }}</td>

        <td class="px-6 py-4 text-center">
          <div class="flex items-center justify-center gap-4">
            <button (click)="openModal(f,'view')" class="text-blue-600 hover:text-blue-800 transition">
              <i class="fas fa-eye"></i>
            </button>
            <button (click)="openModal(f,'edit')" class="text-green-600 hover:text-green-800 transition">
              <i class="fas fa-edit"></i>
            </button>
            <button (click)="deleteFournisseur(f)" class="text-red-600 hover:text-red-800 transition">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </td>

      </tr>
      </tbody>
    </table>
    <div class="flex justify-between items-center mt-4 px-6 py-3">



      <!-- Pagination Controls -->
      <div class="flex justify-center mt-6 w-full">
        <nav class="inline-flex -space-x-px rounded-md shadow-sm" aria-label="Pagination" *ngIf="totalPages > 1">

          <!-- Previous Button -->
          <button (click)="goToPage(page - 1)"
                  [disabled]="page === 1"
                  class="px-3 py-2 rounded-l-md border border-gray-300 bg-white text-gray-500 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
            &laquo;
          </button>

          <!-- Page Numbers -->
          <button *ngFor="let p of pageNumbers"
                  (click)="goToPage(p)"
                  [ngClass]="{'bg-blue-600 text-white': p === page,'bg-white text-gray-700 hover:bg-gray-800': p !== page}" class="px-4 py-2 border border-gray-300">{{ p }}
          </button>

          <!-- Next Button -->
          <button (click)="goToPage(page + 1)"
                  [disabled]="page === totalPages"
                  class="px-3 py-2 rounded-r-md border border-gray-300 bg-white text-gray-800 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed">
            &raquo;
          </button>

        </nav>
      </div>


    </div>

  </div>
</div>

<app-fournisseur-modal *ngIf="showModal" [fournisseur]="selectedFournisseur" [mode]="modalMode" (close)="closeModal()" (save)="saveFournisseur($event)"></app-fournisseur-modal>
